"use strict";(self.webpackChunkcadence=self.webpackChunkcadence||[]).push([[6185],{5410:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"concepts/search-workflows","title":"Search workflows(Advanced visibility)","description":"Introduction","source":"@site/docs/03-concepts/09-search-workflows.md","sourceDirName":"03-concepts","slug":"/concepts/search-workflows","permalink":"/Cadence-Docs/docs/concepts/search-workflows","draft":false,"unlisted":false,"editUrl":"https://github.com/cadence-workflow/Cadence-Docs/tree/master/docs/03-concepts/09-search-workflows.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"layout":"default","title":"Search workflows(Advanced visibility)","permalink":"/docs/concepts/search-workflows"},"sidebar":"docsSidebar","previous":{"title":"Cross DC replication","permalink":"/Cadence-Docs/docs/concepts/cross-dc-replication"},"next":{"title":"HTTP API","permalink":"/Cadence-Docs/docs/concepts/http-api"}}');var r=t(4848),i=t(8453);const o={layout:"default",title:"Search workflows(Advanced visibility)",permalink:"/docs/concepts/search-workflows"},l="Searching Workflows(Advanced visibility)",a={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Memo vs Search Attributes",id:"memo-vs-search-attributes",level:2},{value:"Search Attributes (Go Client Usage)",id:"search-attributes-go-client-usage",level:2},{value:"Allow Listing Search Attributes",id:"allow-listing-search-attributes",level:3},{value:"Keyword vs String(Text)",id:"keyword-vs-stringtext",level:4},{value:"Value Types",id:"value-types",level:3},{value:"Limit",id:"limit",level:3},{value:"Upsert Search Attributes in Workflow",id:"upsert-search-attributes-in-workflow",level:3},{value:"ContinueAsNew and Cron",id:"continueasnew-and-cron",level:3},{value:"Query Capabilities",id:"query-capabilities",level:2},{value:"Supported Operators",id:"supported-operators",level:3},{value:"Default Attributes",id:"default-attributes",level:3},{value:"General Notes About Queries",id:"general-notes-about-queries",level:3},{value:"Tools Support",id:"tools-support",level:2},{value:"CLI",id:"cli",level:3},{value:"Start Workflow with Search Attributes",id:"start-workflow-with-search-attributes",level:4},{value:"Search Workflows with List API/Command",id:"search-workflows-with-list-apicommand",level:4},{value:"Count Workflows with Count API/Command",id:"count-workflows-with-count-apicommand",level:4},{value:"Web UI Support",id:"web-ui-support",level:3},{value:"TLS Support for connecting to Elasticsearch",id:"tls-support-for-connecting-to-elasticsearch",level:3},{value:"Running Locally",id:"running-locally",level:2},{value:"Running in Production",id:"running-in-production",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"searching-workflowsadvanced-visibility",children:"Searching Workflows(Advanced visibility)"})}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(n.p,{children:["Cadence supports creating workflows with customized key-value pairs, updating the information within the workflow code, and then listing/searching workflows with a SQL-like query. For example, you can create workflows with keys ",(0,r.jsx)(n.code,{children:"city"})," and ",(0,r.jsx)(n.code,{children:"age"}),", then search all workflows with ",(0,r.jsx)(n.code,{children:"city = seattle and age > 22"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Also note that normal workflow properties like start time and workflow type can be queried as well. For example, the following query could be specified when ",(0,r.jsx)(n.a,{href:"/docs/cli#list-closed-or-open-workflow-executions",children:"listing workflows from the CLI"})," or using the list APIs (",(0,r.jsx)(n.a,{href:"https://godoc.org/go.uber.org/cadence/client#Client",children:"Go"}),", ",(0,r.jsx)(n.a,{href:"https://static.javadoc.io/com.uber.cadence/cadence-client/2.6.0/com/cadence-workflow/cadence/WorkflowService.Iface.html#ListWorkflowExecutions-com.uber.cadence.ListWorkflowExecutionsRequest-",children:"Java"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'WorkflowType = "main.Workflow" AND CloseStatus != "completed" AND (StartTime >\n   "2019-06-07T16:46:34-08:00" OR CloseTime > "2019-06-07T16:46:34-08:00")\n   ORDER BY StartTime DESC\n'})}),"\n",(0,r.jsxs)(n.p,{children:["In other places, this is also called as ",(0,r.jsx)(n.code,{children:"advanced visibility"}),". While ",(0,r.jsx)(n.code,{children:"basic visibility"})," is referred to basic listing without being able to search."]}),"\n",(0,r.jsx)(n.h2,{id:"memo-vs-search-attributes",children:"Memo vs Search Attributes"}),"\n",(0,r.jsx)(n.p,{children:"Cadence offers two methods for creating workflows with key-value pairs: memo and search attributes. Memo can only be provided on workflow start. Also, memo data are not indexed, and are therefore not searchable. Memo data are visible when listing workflows using the list APIs. Search attributes data are indexed so you can search workflows by querying on these attributes. However, search attributes require the use of Elasticsearch."}),"\n",(0,r.jsxs)(n.p,{children:["Memo and search attributes are available in the Go client in ",(0,r.jsx)(n.a,{href:"https://godoc.org/go.uber.org/cadence/internal#StartWorkflowOptions",children:"StartWorkflowOptions"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type StartWorkflowOptions struct {\n    // ...\n\n    // Memo - Optional non-indexed info that will be shown in list workflow.\n    Memo map[string]interface{}\n\n    // SearchAttributes - Optional indexed info that can be used in query of List/Scan/Count workflow APIs (only\n    // supported when Cadence server is using Elasticsearch). The key and value type must be registered on Cadence server side.\n    // Use GetSearchAttributes API to get valid key and corresponding value type.\n    SearchAttributes map[string]interface{}\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the Java client, the ",(0,r.jsx)(n.em,{children:"WorkflowOptions.Builder"})," has similar methods for ",(0,r.jsx)(n.a,{href:"https://static.javadoc.io/com.uber.cadence/cadence-client/2.6.0/com/cadence-workflow/cadence/client/WorkflowOptions.Builder.html#setMemo-java.util.Map-",children:"memo"})," and ",(0,r.jsx)(n.a,{href:"https://static.javadoc.io/com.uber.cadence/cadence-client/2.6.0/com/cadence-workflow/cadence/client/WorkflowOptions.Builder.html#setSearchAttributes-java.util.Map-",children:"search attributes"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Some important distinctions between memo and search attributes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Memo can support all data types because it is not indexed. Search attributes only support basic data types (including String(aka Text), Int, Float, Bool, Datetime) because it is indexed by Elasticsearch."}),"\n",(0,r.jsx)(n.li,{children:"Memo does not restrict on key names. Search attributes require that keys are allowlisted before using them because Elasticsearch has a limit on indexed keys."}),"\n",(0,r.jsx)(n.li,{children:"Memo doesn't require Cadence clusters to depend on Elasticsearch while search attributes only works with Elasticsearch."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"search-attributes-go-client-usage",children:"Search Attributes (Go Client Usage)"}),"\n",(0,r.jsxs)(n.p,{children:["When using the Cadence Go client, provide key-value pairs as SearchAttributes in ",(0,r.jsx)(n.a,{href:"https://godoc.org/go.uber.org/cadence/internal#StartWorkflowOptions",children:"StartWorkflowOptions"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["SearchAttributes is ",(0,r.jsx)(n.code,{children:"map[string]interface{}"})," where the keys need to be allowlisted so that Cadence knows the attribute key name and value type. The value provided in the map must be the same type as registered."]}),"\n",(0,r.jsx)(n.h3,{id:"allow-listing-search-attributes",children:"Allow Listing Search Attributes"}),"\n",(0,r.jsx)(n.p,{children:"Start by querying the list of search attributes using the "}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ cadence --domain samples-domain cl get-search-attr\n+---------------------+------------+\n|         KEY         | VALUE TYPE |\n+---------------------+------------+\n| CloseStatus         | INT        |\n| CloseTime           | INT        |\n| CustomBoolField     | DOUBLE     |\n| CustomDatetimeField | DATETIME   |\n| CustomDomain        | KEYWORD    |\n| CustomDoubleField   | BOOL       |\n| CustomIntField      | INT        |\n| CustomKeywordField  | KEYWORD    |\n| CustomStringField   | STRING     |\n| DomainID            | KEYWORD    |\n| ExecutionTime       | INT        |\n| HistoryLength       | INT        |\n| RunID               | KEYWORD    |\n| StartTime           | INT        |\n| WorkflowID          | KEYWORD    |\n| WorkflowType        | KEYWORD    |\n+---------------------+------------+\n"})}),"\n",(0,r.jsx)(n.p,{children:"Use the admin CLI to add a new search attribute:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cadence --domain samples-domain adm cl asa --search_attr_key NewKey --search_attr_type 1\n"})}),"\n",(0,r.jsx)(n.p,{children:"The numbers for the attribute types map as follows:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"0 = String(Text)"}),"\n",(0,r.jsx)(n.li,{children:"1 = Keyword"}),"\n",(0,r.jsx)(n.li,{children:"2 = Int"}),"\n",(0,r.jsx)(n.li,{children:"3 = Double"}),"\n",(0,r.jsx)(n.li,{children:"4 = Bool"}),"\n",(0,r.jsx)(n.li,{children:"5 = DateTime"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"keyword-vs-stringtext",children:"Keyword vs String(Text)"}),"\n",(0,r.jsxs)(n.p,{children:["Note 1: ",(0,r.jsx)(n.strong,{children:"String"})," has been renamed to ",(0,r.jsx)(n.strong,{children:"Text"})," in ",(0,r.jsx)(n.a,{href:"https://www.elastic.co/blog/strings-are-dead-long-live-strings",children:"ElasticSearch"}),". Cadence is also ",(0,r.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence/issues/4604",children:"planning"})," to rename it."]}),"\n",(0,r.jsxs)(n.p,{children:["Note 2: ",(0,r.jsx)(n.strong,{children:"Keyword"})," and ",(0,r.jsx)(n.strong,{children:"String(Text)"})," are concepts taken from Elasticsearch. Each word in a ",(0,r.jsx)(n.strong,{children:"String(Text)"})," is considered a searchable keyword. For a UUID, that can be problematic as Elasticsearch will index each portion of the UUID separately. To have the whole string considered as a searchable keyword, use the ",(0,r.jsx)(n.strong,{children:"Keyword"})," type."]}),"\n",(0,r.jsx)(n.p,{children:'For example, key RunID with value "2dd29ab7-2dd8-4668-83e0-89cae261cfb1"'}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["as a ",(0,r.jsx)(n.strong,{children:"Keyword"}),' will only be matched by RunID = "2dd29ab7-2dd8-4668-83e0-89cae261cfb1" (or in the future with ',(0,r.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence/issues/1137",children:"regular expressions"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["as a ",(0,r.jsx)(n.strong,{children:"String(Text)"}),' will be matched by RunID =  "2dd8", which may cause unwanted matches']}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," String(Text) type can not be used in Order By query."]}),"\n",(0,r.jsx)(n.p,{children:"There are some pre-allowlisted search attributes that are handy for testing:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CustomKeywordField"}),"\n",(0,r.jsx)(n.li,{children:"CustomIntField"}),"\n",(0,r.jsx)(n.li,{children:"CustomDoubleField"}),"\n",(0,r.jsx)(n.li,{children:"CustomBoolField"}),"\n",(0,r.jsx)(n.li,{children:"CustomDatetimeField"}),"\n",(0,r.jsx)(n.li,{children:"CustomStringField"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Their types are indicated in their names."}),"\n",(0,r.jsx)(n.h3,{id:"value-types",children:"Value Types"}),"\n",(0,r.jsx)(n.p,{children:"Here are the Search Attribute value types and their correspondent Golang types:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keyword = string"}),"\n",(0,r.jsx)(n.li,{children:"Int = int64"}),"\n",(0,r.jsx)(n.li,{children:"Double = float64"}),"\n",(0,r.jsx)(n.li,{children:"Bool = bool"}),"\n",(0,r.jsx)(n.li,{children:"Datetime = time.Time"}),"\n",(0,r.jsx)(n.li,{children:"String = string"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"limit",children:"Limit"}),"\n",(0,r.jsx)(n.p,{children:"We recommend limiting the number of Elasticsearch indexes by enforcing limits on the following:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Number of keys: 100 per workflow"}),"\n",(0,r.jsx)(n.li,{children:"Size of value: 2kb per value"}),"\n",(0,r.jsx)(n.li,{children:"Total size of key and values: 40kb per workflow"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Cadence reserves keys like DomainID, WorkflowID, and RunID. These can only be used in list queries. The values are not updatable."}),"\n",(0,r.jsx)(n.h3,{id:"upsert-search-attributes-in-workflow",children:"Upsert Search Attributes in Workflow"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://godoc.org/go.uber.org/cadence/workflow#UpsertSearchAttributes",children:"UpsertSearchAttributes"})," is used to add or update search attributes from within the workflow code."]}),"\n",(0,r.jsxs)(n.p,{children:["Go samples for search attributes can be found at ",(0,r.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence-samples/tree/master/cmd/samples/recipes/searchattributes",children:"github.com/cadence-workflow/cadence-samples"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"UpsertSearchAttributes will merge attributes to the existing map in the workflow. Consider this example workflow code:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'func MyWorkflow(ctx workflow.Context, input string) error {\n\n    attr1 := map[string]interface{}{\n        "CustomIntField": 1,\n        "CustomBoolField": true,\n    }\n    workflow.UpsertSearchAttributes(ctx, attr1)\n\n    attr2 := map[string]interface{}{\n        "CustomIntField": 2,\n        "CustomKeywordField": "seattle",\n    }\n    workflow.UpsertSearchAttributes(ctx, attr2)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"After the second call to UpsertSearchAttributes, the map will contain:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'map[string]interface{}{\n    "CustomIntField": 2,\n    "CustomBoolField": true,\n    "CustomKeywordField": "seattle",\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["There is no support for removing a field. To achieve a similar effect, set the field to a sentinel value. For example, to remove \u201cCustomKeywordField\u201d, update it to \u201cimpossibleVal\u201d. Then searching ",(0,r.jsx)(n.code,{children:"CustomKeywordField != \u2018impossibleVal\u2019"}),'  will match workflows with CustomKeywordField not equal to "impossibleVal", which ',(0,r.jsx)(n.strong,{children:"includes"})," workflows without the CustomKeywordField set."]}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"workflow.GetInfo"})," to get current search attributes."]}),"\n",(0,r.jsx)(n.h3,{id:"continueasnew-and-cron",children:"ContinueAsNew and Cron"}),"\n",(0,r.jsxs)(n.p,{children:["When performing a ",(0,r.jsx)(n.a,{href:"/docs/go-client/continue-as-new/",children:"ContinueAsNew"})," or using ",(0,r.jsx)(n.a,{href:"/docs/go-client/distributed-cron/",children:"Cron"}),", search attributes (and memo) will be carried over to the new run by default."]}),"\n",(0,r.jsx)(n.h2,{id:"query-capabilities",children:"Query Capabilities"}),"\n",(0,r.jsxs)(n.p,{children:["Query workflows by using a SQL-like where clause when ",(0,r.jsx)(n.a,{href:"/docs/cli#list-closed-or-open-workflow-executions",children:"listing workflows from the CLI"})," or using the list APIs (",(0,r.jsx)(n.a,{href:"https://godoc.org/go.uber.org/cadence/client#Client",children:"Go"}),", ",(0,r.jsx)(n.a,{href:"https://static.javadoc.io/com.uber.cadence/cadence-client/2.6.0/com/cadence-workflow/cadence/WorkflowService.Iface.html#ListWorkflowExecutions-com.uber.cadence.ListWorkflowExecutionsRequest-",children:"Java"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"Note that you will only see workflows from one domain when querying."}),"\n",(0,r.jsx)(n.h3,{id:"supported-operators",children:"Supported Operators"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"AND"}),", ",(0,r.jsx)(n.code,{children:"OR"}),", ",(0,r.jsx)(n.code,{children:"()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"="}),", ",(0,r.jsx)(n.code,{children:"!="}),", ",(0,r.jsx)(n.code,{children:">"}),", ",(0,r.jsx)(n.code,{children:">="}),", ",(0,r.jsx)(n.code,{children:"<"}),", ",(0,r.jsx)(n.code,{children:"<="})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"IN"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"BETWEEN ... AND"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"ORDER BY"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"default-attributes",children:"Default Attributes"}),"\n",(0,r.jsx)(n.p,{children:"More and more default attributes are added in newer versions.\nPlease get the  by using the CLI get-search-attr command or the GetSearchAttributes API.\nSome names and types are as follows:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"KEY"}),(0,r.jsx)(n.th,{children:"VALUE TYPE"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CloseStatus"}),(0,r.jsx)(n.td,{children:"INT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CloseTime"}),(0,r.jsx)(n.td,{children:"INT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CustomBoolField"}),(0,r.jsx)(n.td,{children:"DOUBLE"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CustomDatetimeField"}),(0,r.jsx)(n.td,{children:"DATETIME"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CustomDomain"}),(0,r.jsx)(n.td,{children:"KEYWORD"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CustomDoubleField"}),(0,r.jsx)(n.td,{children:"BOOL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CustomIntField"}),(0,r.jsx)(n.td,{children:"INT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CustomKeywordField"}),(0,r.jsx)(n.td,{children:"KEYWORD"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CustomStringField"}),(0,r.jsx)(n.td,{children:"STRING"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DomainID"}),(0,r.jsx)(n.td,{children:"KEYWORD"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ExecutionTime"}),(0,r.jsx)(n.td,{children:"INT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"HistoryLength"}),(0,r.jsx)(n.td,{children:"INT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"RunID"}),(0,r.jsx)(n.td,{children:"KEYWORD"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"StartTime"}),(0,r.jsx)(n.td,{children:"INT"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"WorkflowID"}),(0,r.jsx)(n.td,{children:"KEYWORD"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"WorkflowType"}),(0,r.jsx)(n.td,{children:"KEYWORD"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tasklist"}),(0,r.jsx)(n.td,{children:"KEYWORD"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"There are some special considerations for these attributes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CloseStatus, CloseTime, DomainID, ExecutionTime, HistoryLength, RunID, StartTime, WorkflowID, WorkflowType are reserved by Cadence and are read-only"}),"\n",(0,r.jsxs)(n.li,{children:["Starting from ",(0,r.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence/commit/6e69fa1a6e9ae5d2f683759820f09d1286ba7797",children:"v0.18.0"}),", Cadence automatically maps(case insensitive) string to CloseStatus so that you don't need to use integer in the query, to make it easier to use.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'0 = "completed"'}),"\n",(0,r.jsx)(n.li,{children:'1 = "failed"'}),"\n",(0,r.jsx)(n.li,{children:'2 = "canceled"'}),"\n",(0,r.jsx)(n.li,{children:'3 = "terminated"'}),"\n",(0,r.jsx)(n.li,{children:'4 = "continued_as_new"'}),"\n",(0,r.jsx)(n.li,{children:'5 = "timed_out"'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["StartTime, CloseTime and ExecutionTime are stored as INT, but support queries using both EpochTime in nanoseconds, and string in RFC3339 format (ex. ",(0,r.jsx)(n.code,{children:'"2006-01-02T15:04:05+07:00"'}),")"]}),"\n",(0,r.jsx)(n.li,{children:"CloseTime, CloseStatus, HistoryLength are only present in closed workflow"}),"\n",(0,r.jsx)(n.li,{children:"ExecutionTime is for Retry/Cron user to query a workflow that will run in the future"}),"\n",(0,r.jsxs)(n.li,{children:["To list only open workflows, add ",(0,r.jsx)(n.code,{children:"CloseTime = missing"})," to the end of the query."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["If you use retry or the cron feature to query workflows that will start execution in a certain time range, you can add predicates on ExecutionTime. For example: ",(0,r.jsx)(n.code,{children:"ExecutionTime > 2019-01-01T10:00:00-07:00"}),". Note that if predicates on ExecutionTime are included, only cron or a workflow that needs to retry will be returned."]}),"\n",(0,r.jsx)(n.h3,{id:"general-notes-about-queries",children:"General Notes About Queries"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pagesize default is 1000, and cannot be larger than 10k"}),"\n",(0,r.jsx)(n.li,{children:"Range query on Cadence timestamp (StartTime, CloseTime, ExecutionTime) cannot be larger than 9223372036854775807 (maxInt64 - 1001)"}),"\n",(0,r.jsx)(n.li,{children:"Query by time range will have 1ms resolution"}),"\n",(0,r.jsx)(n.li,{children:"Query column names are case sensitive"}),"\n",(0,r.jsx)(n.li,{children:"ListWorkflow may take longer when retrieving a large number of workflows (10M+)"}),"\n",(0,r.jsx)(n.li,{children:"To retrieve a large number of workflows without caring about order, use the ScanWorkflow API"}),"\n",(0,r.jsx)(n.li,{children:"To efficiently count the number of workflows, use the CountWorkflow API"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"tools-support",children:"Tools Support"}),"\n",(0,r.jsx)(n.h3,{id:"cli",children:"CLI"}),"\n",(0,r.jsxs)(n.p,{children:["Support for search attributes is available as of version 0.6.0 of the Cadence server. You can also use the CLI from the latest ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/ubercadence/cli",children:"CLI Docker image"})," (supported on 0.6.4 or later)."]}),"\n",(0,r.jsx)(n.h4,{id:"start-workflow-with-search-attributes",children:"Start Workflow with Search Attributes"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cadence --do samples-domain workflow start --tl helloWorldGroup --wt main.Workflow --et 60 --dt 10 -i '\"vancexu\"' -search_attr_key 'CustomIntField | CustomKeywordField | CustomStringField |  CustomBoolField | CustomDatetimeField' -search_attr_value '5 | keyword1 | vancexu test | true | 2019-06-07T16:16:36-08:00'\n"})}),"\n",(0,r.jsx)(n.h4,{id:"search-workflows-with-list-apicommand",children:"Search Workflows with List API/Command"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cadence --do samples-domain wf list -q \'(CustomKeywordField = "keyword1" and CustomIntField >= 5) or CustomKeywordField = "keyword2"\' -psa\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cadence --do samples-domain wf list -q \'CustomKeywordField in ("keyword2", "keyword1") and CustomIntField >= 5 and CloseTime between "2018-06-07T16:16:36-08:00" and "2019-06-07T16:46:34-08:00" order by CustomDatetimeField desc\' -psa\n'})}),"\n",(0,r.jsxs)(n.p,{children:["To list only open workflows, add ",(0,r.jsx)(n.code,{children:"CloseTime = missing"})," to the end of the query."]}),"\n",(0,r.jsx)(n.p,{children:"Note that queries can support more than one type of filter:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cadence --do samples-domain wf list -q \'WorkflowType = "main.Workflow" and (WorkflowID = "1645a588-4772-4dab-b276-5f9db108b3a8" or RunID = "be66519b-5f09-40cd-b2e8-20e4106244dc")\'\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cadence --do samples-domain wf list -q \'WorkflowType = "main.Workflow" StartTime > "2019-06-07T16:46:34-08:00" and CloseTime = missing\'\n'})}),"\n",(0,r.jsx)(n.p,{children:"All above command can be done with ListWorkflowExecutions API."}),"\n",(0,r.jsx)(n.h4,{id:"count-workflows-with-count-apicommand",children:"Count Workflows with Count API/Command"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cadence --do samples-domain wf count -q \'(CustomKeywordField = "keyword1" and CustomIntField >= 5) or CustomKeywordField = "keyword2"\'\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cadence --do samples-domain wf count -q 'CloseStatus=\"failed\"'\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cadence --do samples-domain wf count -q 'CloseStatus!=\"completed\"'\n"})}),"\n",(0,r.jsx)(n.p,{children:"All above command can be done with CountWorkflowExecutions API."}),"\n",(0,r.jsx)(n.h3,{id:"web-ui-support",children:"Web UI Support"}),"\n",(0,r.jsxs)(n.p,{children:["Queries are supported in ",(0,r.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence-web",children:"Cadence Web"}),' as of release 3.4.0. Use the "Basic/Advanced" button to switch to "Advanced" mode and type the query in the search box.']}),"\n",(0,r.jsx)(n.h3,{id:"tls-support-for-connecting-to-elasticsearch",children:"TLS Support for connecting to Elasticsearch"}),"\n",(0,r.jsxs)(n.p,{children:["If your elasticsearch deployment requires TLS to connect to it, you can add the following to your config template.\nThe TLS config is optional and when not provided it defaults to tls.enabled to ",(0,r.jsx)(n.strong,{children:"false"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'elasticsearch:\n  url:\n    scheme: "https"\n    host: "127.0.0.1:9200"\n  indices:\n    visibility: cadence-visibility-dev\n  tls:\n    enabled: true\n    caFile: /secrets/cadence/elasticsearch_cert.pem\n    enableHostVerification: true\n    serverName: myServerName\n    certFile: /secrets/cadence/certfile.crt\n    keyFile: /secrets/cadence/keyfile.key\n    sslmode: false\n'})}),"\n",(0,r.jsx)(n.h2,{id:"running-locally",children:"Running Locally"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Increase Docker memory to higher than 6GB. Navigate to Docker -> Preferences -> Advanced -> Memory"}),"\n",(0,r.jsxs)(n.li,{children:["Get the Cadence Docker compose file. Run ",(0,r.jsx)(n.code,{children:"curl -O https://raw.githubusercontent.com/cadence-workflow/cadence/master/docker/docker-compose-es.yml"})]}),"\n",(0,r.jsxs)(n.li,{children:["Start Cadence Docker (which contains Apache Kafka, Apache Zookeeper, and Elasticsearch) using ",(0,r.jsx)(n.code,{children:"docker-compose -f docker-compose-es.yml up"})]}),"\n",(0,r.jsxs)(n.li,{children:["From the Docker output log, make sure Elasticsearch and Cadence started correctly. If you encounter an insufficient disk space error, try ",(0,r.jsx)(n.code,{children:"docker system prune -a --volumes"})]}),"\n",(0,r.jsxs)(n.li,{children:["Register a local domain and start using it. ",(0,r.jsx)(n.code,{children:"cadence --do samples-domain d re"})]}),"\n",(0,r.jsxs)(n.li,{children:["Add the key to ElasticSearch And also allowlist search attributes. ",(0,r.jsx)(n.code,{children:"cadence --do domain adm cl asa --search_attr_key NewKey --search_attr_type 1"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"running-in-production",children:"Running in Production"}),"\n",(0,r.jsx)(n.p,{children:"To enable this feature in a Cadence cluster:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Register index schema on ElasticSearch. Run two CURL commands following this ",(0,r.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence/blob/a05ce6b0328b89aa516ae09d5ff601e35df2cc4f/docker/start.sh#L59",children:"script"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create a index template by using the schema , choose v6/v7 based on your ElasticSearch version"}),"\n",(0,r.jsx)(n.li,{children:"Create an index follow the index template, remember the name"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Register topic on Kafka, and  remember the name","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Set up the right number of partitions based on your expected throughput(can be scaled up later)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence/blob/master/docs/visibility-on-elasticsearch.md#configuration",children:"Configure Cadence for ElasticSearch + Kafka like this documentation"}),"\nBased on the full ",(0,r.jsx)(n.a,{href:"/docs/operation-guide/setup/#static-configuration",children:"static config"}),", you may add some other fields like AuthN.\nSimilarly for Kafka."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To add new search attributes:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Add the key to ElasticSearch  ",(0,r.jsx)(n.code,{children:"cadence --do domain adm cl asa --search_attr_key NewKey --search_attr_type 1"})]}),"\n",(0,r.jsxs)(n.li,{children:["Update the ",(0,r.jsx)(n.a,{href:"https://cadenceworkflow.io/docs/operation-guide/setup/#dynamic-configuration-overview",children:"dynamic configuration"})," to allowlist the new attribute"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Note: starting a workflow with search attributes but without advanced visibility feature will succeed as normal, but will not be searchable and will not be shown in list results."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var s=t(6540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);