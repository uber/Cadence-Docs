"use strict";(self.webpackChunkcadence=self.webpackChunkcadence||[]).push([[2222],{725:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>w,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"go-client/02.5-starting-workflows","title":"Starting workflows","description":"Starting workflows can be done from any service that can send requests to","source":"@site/docs/05-go-client/02.5-starting-workflows.md","sourceDirName":"05-go-client","slug":"/go-client/02.5-starting-workflows","permalink":"/docs/go-client/02.5-starting-workflows","draft":false,"unlisted":false,"editUrl":"https://github.com/cadence-workflow/Cadence-Docs/tree/master/docs/05-go-client/02.5-starting-workflows.md","tags":[],"version":"current","frontMatter":{"layout":"default","title":"Starting workflows","permalink":"/docs/go-client/start-workflows"},"sidebar":"docsSidebar","previous":{"title":"Creating workflows","permalink":"/docs/go-client/create-workflows"},"next":{"title":"Activity overview","permalink":"/docs/go-client/activities"}}');var r=o(4848),i=o(8453);const s={layout:"default",title:"Starting workflows",permalink:"/docs/go-client/start-workflows"},l="Starting workflows",a={},c=[{value:"Starting a workflow",id:"starting-a-workflow",level:2},{value:"Jitter Start and Batches of Workflows",id:"jitter-start-and-batches-of-workflows",level:2},{value:"StartWorkflowOptions",id:"startworkflowoptions",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"starting-workflows",children:"Starting workflows"})}),"\n",(0,r.jsx)(t.p,{children:"Starting workflows can be done from any service that can send requests to\nthe Cadence server. There is no requirement for workflows to be started from the\nworker services."}),"\n",(0,r.jsxs)(t.p,{children:["Generally workflows can either be started using a direct reference to the\nworkflow code, or by referring to the registered name of the function. In\n",(0,r.jsx)(t.a,{href:"/docs/go-client/create-workflows/#registration",children:"Workflow Registration"})," we show\nhow to register the workflows."]}),"\n",(0,r.jsx)(t.h2,{id:"starting-a-workflow",children:"Starting a workflow"}),"\n",(0,r.jsxs)(t.p,{children:["After ",(0,r.jsx)(t.a,{href:"/docs/go-client/create-workflows",children:"creating a workflow"})," we can start it.\nThis can be done ",(0,r.jsx)(t.a,{href:"/docs/cli/#start-workflow",children:"from the cli"}),", but typically\nwe want to start workflow programmatically e.g. from an http handler. We can do\nthis using the\n",(0,r.jsx)(t.a,{href:"https://pkg.go.dev/go.uber.org/cadence/client#Client",children:(0,r.jsx)(t.code,{children:"client.StartWorkflow"})}),"\nfunction:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'import "go.uber.org/cadence/client"\n\nvar cadenceClient client.Client \n# Initialize cadenceClient\n\ncadenceClient.StartWorkflow(\n    ctx,\n    client.StartWorkflowOptions{\n        TaskList: "workflow-task-list",\n        ExecutionStartToCloseTimeout: 10 * time.Second,\n    },\n    WorkflowFunc,\n    workflowArg1,\n    workflowArg2,\n    workflowArg3,\n    ...\n)\n'})}),"\n",(0,r.jsxs)(t.p,{children:["The will start the workflow defined in the function ",(0,r.jsx)(t.code,{children:"WorkflowFunc"}),", note that\nfor named workflows ",(0,r.jsx)(t.code,{children:"WorkflowFunc"})," could be replaced by the name e.g.\n",(0,r.jsx)(t.code,{children:'"WorkflowFuncName"'}),"."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"workflowArg1"}),", ",(0,r.jsx)(t.code,{children:"workflowArg2"}),", ",(0,r.jsx)(t.code,{children:"workflowArg3"})," are arguments to the workflow, as\nspecified in ",(0,r.jsx)(t.code,{children:"WorkflowFunc"}),", note that the arguments needs to be ",(0,r.jsx)(t.em,{children:"serializable"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"jitter-start-and-batches-of-workflows",children:"Jitter Start and Batches of Workflows"}),"\n",(0,r.jsxs)(t.p,{children:["Below we list all the ",(0,r.jsx)(t.code,{children:"startWorkflowOptions"}),", however a particularly useful option is\n",(0,r.jsx)(t.code,{children:"JitterStart"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Starting many workflows at the same time will have Cadence trying to schedule\nall the workflows immediately. This can result in overloading Cadence and the\ndatabase backing Cadence, as well as the workers processing the workflows."}),"\n",(0,r.jsx)(t.p,{children:"This is especially bad when the workflow starts comes in batches, such as an end\nof month load. These sudden loads can lead to both Cadence and the workers\nneeding to immediately scale up. Scaling up often takes some time, causing\nqueues in Cadence, delaying the execution of all workflows, potentially causing\nworkflows to timeout."}),"\n",(0,r.jsxs)(t.p,{children:["To solve this we can start our workflows with ",(0,r.jsx)(t.code,{children:"JitterStart"}),". ",(0,r.jsx)(t.code,{children:"JitterStart"})," will start\nthe workflow at a random point between ",(0,r.jsx)(t.code,{children:"now"})," and ",(0,r.jsx)(t.code,{children:"now + JitterStart"}),", so if we\ne.g. start 1000 workflows at 12:00 AM with a ",(0,r.jsx)(t.code,{children:"JitterStart"})," of 6 hours, the\nworkflows will be randomly started between 12:00 AM and 6:00 PM."]}),"\n",(0,r.jsx)(t.p,{children:"This makes the sudden load of 1000 workflows much more manageable."}),"\n",(0,r.jsx)(t.p,{children:"For many batch-like workloads a random delay is completely acceptable as the\nbatch just needs to be processed e.g. before the end of the day."}),"\n",(0,r.jsx)(t.p,{children:"Adding a JitterStart of 6 hours in the example above is as simple as adding"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"JitterStart: 6 * time.Hour,\n"})}),"\n",(0,r.jsx)(t.p,{children:"to the options like so,"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:'import "go.uber.org/cadence/client"\n\nvar cadenceClient client.Client\n# Initialize cadenceClient\n\ncadenceClient.StartWorkflow(\n    ctx,\n    client.StartWorkflowOptions{\n        TaskList: "workflow-task-list",\n        ExecutionStartToCloseTimeout: 10 * time.Second,\n        JitterStart: 6 * time.Hour, // Added JitterStart\n    },\n    WorkflowFunc,\n    workflowArg1,\n    workflowArg2,\n    workflowArg3,\n    ...\n)\n'})}),"\n",(0,r.jsx)(t.p,{children:"now the workflow will start at a random point between now and six hours from now."}),"\n",(0,r.jsx)(t.h2,{id:"startworkflowoptions",children:"StartWorkflowOptions"}),"\n",(0,r.jsxs)(t.p,{children:["The\n",(0,r.jsx)(t.a,{href:"https://pkg.go.dev/go.uber.org/cadence/internal#StartWorkflowOptions",children:"client.StartWorkflowOptions"}),"\nspecifies the behavior of this particular workflow. The invocation above only\nspecifies the two mandatory options; ",(0,r.jsx)(t.code,{children:"TaskList"})," and\n",(0,r.jsx)(t.code,{children:"ExecutionStartToCloseTimeout"}),", all the options are described in the ",(0,r.jsx)(t.a,{href:"https://pkg.go.dev/go.uber.org/cadence/internal#StartWorkflowOptions",children:"inline\ndocumentation"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-go",children:"type StartWorkflowOptions struct {\n\t// ID - The business identifier of the workflow execution.\n\t// Optional: defaulted to a uuid.\n\tID string\n\n\t// TaskList - The decisions of the workflow are scheduled on this queue.\n\t// This is also the default task list on which activities are scheduled. The workflow author can choose\n\t// to override this using activity options.\n\t// Mandatory: No default.\n\tTaskList string\n\n\t// ExecutionStartToCloseTimeout - The timeout for duration of workflow execution.\n\t// The resolution is seconds.\n\t// Mandatory: No default.\n\tExecutionStartToCloseTimeout time.Duration\n\n\t// DecisionTaskStartToCloseTimeout - The timeout for processing decision task from the time the worker\n\t// pulled this task. If a decision task is lost, it is retried after this timeout.\n\t// The resolution is seconds.\n\t// Optional: defaulted to 10 secs.\n\tDecisionTaskStartToCloseTimeout time.Duration\n\n\t// WorkflowIDReusePolicy - Whether server allow reuse of workflow ID, can be useful\n\t// for dedup logic if set to WorkflowIdReusePolicyRejectDuplicate.\n\t// Optional: defaulted to WorkflowIDReusePolicyAllowDuplicateFailedOnly.\n\tWorkflowIDReusePolicy WorkflowIDReusePolicy\n\n\t// RetryPolicy - Optional retry policy for workflow. If a retry policy is specified, in case of workflow failure\n\t// server will start new workflow execution if needed based on the retry policy.\n\tRetryPolicy *RetryPolicy\n\n\t// CronSchedule - Optional cron schedule for workflow. If a cron schedule is specified, the workflow will run\n\t// as a cron based on the schedule. The scheduling will be based on UTC time. Schedule for next run only happen\n\t// after the current run is completed/failed/timeout. If a RetryPolicy is also supplied, and the workflow failed\n\t// or timeout, the workflow will be retried based on the retry policy. While the workflow is retrying, it won't\n\t// schedule its next run. If next schedule is due while workflow is running (or retrying), then it will skip that\n\t// schedule. Cron workflow will not stop until it is terminated or cancelled (by returning cadence.CanceledError).\n\t// The cron spec is as following:\n\t// \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0 - 59)\n\t// \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0 - 23)\n\t// \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of the month (1 - 31)\n\t// \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 month (1 - 12)\n\t// \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of the week (0 - 6) (Sunday to Saturday)\n\t// \u2502 \u2502 \u2502 \u2502 \u2502\n\t// \u2502 \u2502 \u2502 \u2502 \u2502\n\t// * * * * *\n\tCronSchedule string\n\n\t// Memo - Optional non-indexed info that will be shown in list workflow.\n\tMemo map[string]interface{}\n\n\t// SearchAttributes - Optional indexed info that can be used in query of List/Scan/Count workflow APIs (only\n\t// supported when Cadence server is using ElasticSearch). The key and value type must be registered on Cadence server side.\n\t// Use GetSearchAttributes API to get valid key and corresponding value type.\n\tSearchAttributes map[string]interface{}\n\n\t// DelayStartSeconds - Seconds to delay the workflow start\n\t// The resolution is seconds.\n\t// Optional: defaulted to 0 seconds\n\tDelayStart time.Duration\n\n\t// JitterStart - Seconds to jitter the workflow start. For example, if set to 10, the workflow will start some time between 0-10 seconds.\n\t// This works with CronSchedule and with DelayStart.\n\t// Optional: defaulted to 0 seconds\n\tJitterStart time.Duration\n}\n"})})]})}function w(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>l});var n=o(6540);const r={},i=n.createContext(r);function s(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);