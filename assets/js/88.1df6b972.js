(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{398:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"sessions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sessions"}},[t._v("#")]),t._v(" Sessions")]),t._v(" "),e("p",[t._v("The session framework provides a straightforward interface for scheduling multiple "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" on a single "),e("Term",{attrs:{term:"worker"}}),t._v(" without requiring you to manually specify the "),e("Term",{attrs:{term:"task_list"}}),t._v(" name. It also includes features like "),e("strong",[t._v("concurrent session limitation")]),t._v(" and "),e("strong",[t._v("worker failure detection")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"use-cases"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#use-cases"}},[t._v("#")]),t._v(" Use Cases")]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("File Processing")]),t._v(": You may want to implement a "),e("Term",{attrs:{term:"workflow"}}),t._v(" that can download a file, process it, and then upload the modified version. If these three steps are implemented as three different "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(", all of them should be executed by the same "),e("Term",{attrs:{term:"worker"}}),t._v(".")],1)]),t._v(" "),e("li",[e("p",[e("strong",[t._v("Machine Learning Model Training")]),t._v(": Training a machine learning model typically involves three stages: download the data set, optimize the model, and upload the trained parameter. Since the models may consume a large amount of resources (GPU memory for example), the number of models processed on a host needs to be limited.")])])]),t._v(" "),e("h2",{attrs:{id:"basic-usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#basic-usage"}},[t._v("#")]),t._v(" Basic Usage")]),t._v(" "),e("p",[t._v("Before using the session framework to write your "),e("Term",{attrs:{term:"workflow"}}),t._v(" code, you need to configure your "),e("Term",{attrs:{term:"worker"}}),t._v(" to process sessions. To do that, set the "),e("code",[t._v("EnableSessionWorker")]),t._v(" field of "),e("code",[t._v("worker.Options")]),t._v(" to "),e("code",[t._v("true")]),t._v(" when starting your "),e("Term",{attrs:{term:"worker"}}),t._v(".")],1),t._v(" "),e("p",[t._v("The most important APIs provided by the session framework are "),e("code",[t._v("workflow.CreateSession()")]),t._v(" and "),e("code",[t._v("workflow.CompleteSession()")]),t._v(". The basic idea is that all the "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" executed within a session will be processed by the same "),e("Term",{attrs:{term:"worker"}}),t._v(" and these two APIs allow you to create new sessions and close them after all "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" finish executing.")],1),t._v(" "),e("p",[t._v("Here's a more detailed description of these two APIs:")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" SessionOptions "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ExecutionTimeout: required, no default.")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     Specifies the maximum amount of time the session can run.")]),t._v("\n    ExecutionTimeout time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// CreationTimeout: required, no default.")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     Specifies how long session creation can take before returning an error.")]),t._v("\n    CreationTimeout  time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateSession")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sessionOptions "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("SessionOptions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[e("code",[t._v("CreateSession()")]),t._v(" takes in "),e("code",[t._v("workflow.Context")]),t._v(", "),e("code",[t._v("sessionOptions")]),t._v(" and returns a new context which contains metadata information of the created session (referred to as the "),e("strong",[t._v("session context")]),t._v(" below). When it's called, it will check the "),e("Term",{attrs:{term:"task_list"}}),t._v(" name specified in the "),e("code",[t._v("ActivityOptions")]),t._v(" (or in the "),e("code",[t._v("StartWorkflowOptions")]),t._v(" if the "),e("Term",{attrs:{term:"task_list"}}),t._v(" name is not specified in "),e("code",[t._v("ActivityOptions")]),t._v("), and create the session on one of the "),e("Term",{attrs:{term:"worker",show:"workers"}}),t._v(" which is polling that "),e("Term",{attrs:{term:"task_list"}}),t._v(".")],1),t._v(" "),e("p",[t._v("The returned session context should be used to execute all "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" belonging to the session. The context will be cancelled if the "),e("Term",{attrs:{term:"worker"}}),t._v(" executing this session dies or "),e("code",[t._v("CompleteSession()")]),t._v(" is called. When using the returned session context to execute "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(", a "),e("code",[t._v("workflow.ErrSessionFailed")]),t._v(" error may be returned if the session framework detects that the "),e("Term",{attrs:{term:"worker"}}),t._v(" executing this session has died. The failure of your "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" won't affect the state of the session, so you still need to handle the errors returned from your "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" and call "),e("code",[t._v("CompleteSession()")]),t._v(" if necessary.")],1),t._v(" "),e("p",[e("code",[t._v("CreateSession()")]),t._v(" will return an error if the context passed in already contains an open session. If all the "),e("Term",{attrs:{term:"worker",show:"workers"}}),t._v(" are currently busy and unable to handle new sessions, the framework will keep retrying until the "),e("code",[t._v("CreationTimeout")]),t._v(" you specified in "),e("code",[t._v("SessionOptions")]),t._v(" has passed before returning an error (check the "),e("strong",[t._v("Concurrent Session Limitation")]),t._v(" section for more details).")],1),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CompleteSession")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[e("code",[t._v("CompleteSession()")]),t._v(" releases the resources reserved on the "),e("Term",{attrs:{term:"worker"}}),t._v(", so it's important to call it as soon as you no longer need the session. It will cancel the session context and therefore all the "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" using that session context. Note that it's safe to call "),e("code",[t._v("CompleteSession()")]),t._v(" on a failed session, meaning that you can call it from a "),e("code",[t._v("defer")]),t._v(" function after the session is successfully created.")],1),t._v(" "),e("h3",{attrs:{id:"sample-code"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sample-code"}},[t._v("#")]),t._v(" Sample Code")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("FileProcessingWorkflow")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileID "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ao "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ActivityOptions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ScheduleToStartTimeout"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Second "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        StartToCloseTimeout"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Minute"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    ctx "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("WithActivityOptions")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ao"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    so "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SessionOptions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        CreationTimeout"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Minute"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        ExecutionTimeout"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Minute"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateSession")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" so"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CompleteSession")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fInfo "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("fileInfo\n    err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ExecuteActivity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" downloadFileActivityName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileID"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("fInfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fInfoProcessed "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("fileInfo\n    err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ExecuteActivity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" processFileActivityName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("fInfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("fInfoProcessed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" err\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ExecuteActivity")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uploadFileActivityName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("fInfoProcessed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"session-metadata"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#session-metadata"}},[t._v("#")]),t._v(" Session Metadata")]),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" SessionInfo "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A unique ID for the session")]),t._v("\n    SessionID         "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The hostname of the worker that is executing the session")]),t._v("\n    HostName          "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... other unexported fields")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetSessionInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("SessionInfo\n")])])]),e("p",[t._v("The session context also stores some session metadata, which can be retrieved by the "),e("code",[t._v("GetSessionInfo()")]),t._v(" API. If the context passed in doesn't contain any session metadata, this API will return a "),e("code",[t._v("nil")]),t._v(" pointer.")]),t._v(" "),e("h2",{attrs:{id:"concurrent-session-limitation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#concurrent-session-limitation"}},[t._v("#")]),t._v(" Concurrent Session Limitation")]),t._v(" "),e("p",[t._v("To limit the number of concurrent sessions running on a "),e("Term",{attrs:{term:"worker"}}),t._v(", set the "),e("code",[t._v("MaxConcurrentSessionExecutionSize")]),t._v(" field of "),e("code",[t._v("worker.Options")]),t._v(" to the desired value. By default this field is set to a very large value, so there's no need to manually set it if no limitation is needed.")],1),t._v(" "),e("p",[t._v("If a "),e("Term",{attrs:{term:"worker"}}),t._v(" hits this limitation, it won't accept any new "),e("code",[t._v("CreateSession()")]),t._v(" requests until one of the existing sessions is completed. "),e("code",[t._v("CreateSession()")]),t._v(" will return an error if the session can't be created within "),e("code",[t._v("CreationTimeout")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"recreate-session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#recreate-session"}},[t._v("#")]),t._v(" Recreate Session")]),t._v(" "),e("p",[t._v("For long-running sessions, you may want to use the "),e("code",[t._v("ContinueAsNew")]),t._v(" feature to split the "),e("Term",{attrs:{term:"workflow"}}),t._v(" into multiple runs when all "),e("Term",{attrs:{term:"activity",show:"activities"}}),t._v(" need to be executed by the same "),e("Term",{attrs:{term:"worker"}}),t._v(". The "),e("code",[t._v("RecreateSession()")]),t._v("  API is designed for such a use case.")],1),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecreateSession")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" recreateToken "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sessionOptions "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("SessionOptions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("Its usage is the same as "),e("code",[t._v("CreateSession()")]),t._v(" except that it also takes in a "),e("code",[t._v("recreateToken")]),t._v(", which is needed to create a new session on the same "),e("Term",{attrs:{term:"worker"}}),t._v(" as the previous one. You can get the token by calling the "),e("code",[t._v("GetRecreateToken()")]),t._v(" method of the "),e("code",[t._v("SessionInfo")]),t._v(" object.")],1),t._v(" "),e("div",{staticClass:"language-go extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[t._v("token "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" workflow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetSessionInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessionCtx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetRecreateToken")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"q-a"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#q-a"}},[t._v("#")]),t._v(" Q & A")]),t._v(" "),e("h3",{attrs:{id:"is-there-a-complete-example"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#is-there-a-complete-example"}},[t._v("#")]),t._v(" Is there a complete example?")]),t._v(" "),e("p",[t._v("Yes, the "),e("a",{attrs:{href:"https://github.com/uber-common/cadence-samples/blob/master/cmd/samples/fileprocessing/workflow.go",target:"_blank",rel:"noopener noreferrer"}},[t._v("file processing example"),e("OutboundLink")],1),t._v(" in the cadence-sample repo has been updated to use the session framework.")]),t._v(" "),e("h3",{attrs:{id:"what-happens-to-my-activity-if-the-worker-dies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-happens-to-my-activity-if-the-worker-dies"}},[t._v("#")]),t._v(" What happens to my activity if the worker dies?")]),t._v(" "),e("p",[t._v("If your "),e("Term",{attrs:{term:"activity"}}),t._v(" has already been scheduled, it will be cancelled. If not, you will get a "),e("code",[t._v("workflow.ErrSessionFailed")]),t._v(" error when you call "),e("code",[t._v("workflow.ExecuteActivity()")]),t._v(".")],1),t._v(" "),e("h3",{attrs:{id:"is-the-concurrent-session-limitation-per-process-or-per-host"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#is-the-concurrent-session-limitation-per-process-or-per-host"}},[t._v("#")]),t._v(" Is the concurrent session limitation per process or per host?")]),t._v(" "),e("p",[t._v("It's per "),e("Term",{attrs:{term:"worker"}}),t._v(" process, so make sure there's only one "),e("Term",{attrs:{term:"worker"}}),t._v(" process running on the host if you plan to use that feature.")],1),t._v(" "),e("h2",{attrs:{id:"future-work"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#future-work"}},[t._v("#")]),t._v(" Future Work")]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[e("a",{attrs:{href:"https://github.com/uber-go/cadence-client/issues/775",target:"_blank",rel:"noopener noreferrer"}},[t._v("Support automatic session re-establishing"),e("OutboundLink")],1)]),t._v("\nRight now a session is considered failed if the "),e("Term",{attrs:{term:"worker"}}),t._v(" process dies. However, for some use cases, you may only care whether "),e("Term",{attrs:{term:"worker"}}),t._v(" host is alive or not. For these uses cases, the session should be automatically re-established if the "),e("Term",{attrs:{term:"worker"}}),t._v(" process is restarted.")],1)]),t._v(" "),e("li",[e("p",[e("strong",[e("a",{attrs:{href:"https://github.com/uber-go/cadence-client/issues/776",target:"_blank",rel:"noopener noreferrer"}},[t._v("Support fine-grained concurrent session limitation"),e("OutboundLink")],1)]),t._v("\nThe current implementation assumes that all sessions are consuming the same type of resource and there's only one global limitation. Our plan is to allow you to specify what type of resource your session will consume and enforce different limitations on different types of resources.")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);