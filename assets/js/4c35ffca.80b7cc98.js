"use strict";(self.webpackChunkcadence=self.webpackChunkcadence||[]).push([[2872],{8539:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>s});const o=JSON.parse('{"id":"java-client/exception-handling","title":"Exception Handling","description":"By default, Exceptions thrown by an activity are received by the workflow wrapped into an com.uber.cadence.workflow.ActivityFailureException,","source":"@site/docs/04-java-client/14-exception-handling.md","sourceDirName":"04-java-client","slug":"/java-client/exception-handling","permalink":"/Cadence-Docs/docs/java-client/exception-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/cadence-workflow/Cadence-Docs/tree/master/docs/04-java-client/14-exception-handling.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"layout":"default","title":"Exception Handling","permalink":"/docs/java-client/exception-handling"},"sidebar":"docsSidebar","previous":{"title":"Child workflows","permalink":"/Cadence-Docs/docs/java-client/child-workflows"},"next":{"title":"Continue As New","permalink":"/Cadence-Docs/docs/java-client/continue-as-new"}}');var i=t(4848),r=t(8453);const a={layout:"default",title:"Exception Handling",permalink:"/docs/java-client/exception-handling"},c="Exception Handling",l={},s=[];function d(e){const n={a:"a",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"exception-handling",children:"Exception Handling"})}),"\n",(0,i.jsxs)(n.p,{children:["By default, Exceptions thrown by an activity are received by the workflow wrapped into an ",(0,i.jsx)(n.code,{children:"com.uber.cadence.workflow.ActivityFailureException"}),","]}),"\n",(0,i.jsxs)(n.p,{children:["Exceptions thrown by a child workflow are received by a parent workflow wrapped into a ",(0,i.jsx)(n.code,{children:"com.uber.cadence.workflow.ChildWorkflowFailureException"})]}),"\n",(0,i.jsxs)(n.p,{children:["Exceptions thrown by a workflow are received by a workflow client wrapped into ",(0,i.jsx)(n.code,{children:"com.uber.cadence.client.WorkflowFailureException"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["In this ",(0,i.jsx)(n.a,{href:"https://github.com/cadence-workflow/cadence-java-samples/blob/master/src/main/java/com/uber/cadence/samples/hello/HelloException.java",children:"example"})," a Workflow Client executes a workflow which executes a child workflow which\nexecutes an activity which throws an IOException. The resulting exception stack trace is:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-log",children:' com.uber.cadence.client.WorkflowFailureException: WorkflowType="GreetingWorkflow::getGreeting", WorkflowID="38b9ce7a-e370-4cd8-a9f3-35e7295f7b3d", RunID="37ceb58c-9271-4fca-b5aa-ba06c5495214\n     at com.uber.cadence.internal.dispatcher.UntypedWorkflowStubImpl.getResult(UntypedWorkflowStubImpl.java:139)\n     at com.uber.cadence.internal.dispatcher.UntypedWorkflowStubImpl.getResult(UntypedWorkflowStubImpl.java:111)\n     at com.uber.cadence.internal.dispatcher.WorkflowExternalInvocationHandler.startWorkflow(WorkflowExternalInvocationHandler.java:187)\n     at com.uber.cadence.internal.dispatcher.WorkflowExternalInvocationHandler.invoke(WorkflowExternalInvocationHandler.java:113)\n     at com.sun.proxy.$Proxy2.getGreeting(Unknown Source)\n     at com.uber.cadence.samples.hello.HelloException.main(HelloException.java:117)\n Caused by: com.uber.cadence.workflow.ChildWorkflowFailureException: WorkflowType="GreetingChild::composeGreeting", ID="37ceb58c-9271-4fca-b5aa-ba06c5495214:1", RunID="47859b47-da4c-4225-876a-462421c98c72, EventID=10\n     at java.lang.Thread.getStackTrace(Thread.java:1559)\n     at com.uber.cadence.internal.dispatcher.ChildWorkflowInvocationHandler.executeChildWorkflow(ChildWorkflowInvocationHandler.java:114)\n     at com.uber.cadence.internal.dispatcher.ChildWorkflowInvocationHandler.invoke(ChildWorkflowInvocationHandler.java:71)\n     at com.sun.proxy.$Proxy5.composeGreeting(Unknown Source:0)\n     at com.uber.cadence.samples.hello.HelloException$GreetingWorkflowImpl.getGreeting(HelloException.java:70)\n     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method:0)\n     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n     at java.lang.reflect.Method.invoke(Method.java:498)\n     at com.uber.cadence.internal.worker.POJOWorkflowImplementationFactory$POJOWorkflowImplementation.execute(POJOWorkflowImplementationFactory.java:160)\n Caused by: com.uber.cadence.workflow.ActivityFailureException: ActivityType="GreetingActivities::composeGreeting" ActivityID="1", EventID=7\n     at java.lang.Thread.getStackTrace(Thread.java:1559)\n     at com.uber.cadence.internal.dispatcher.ActivityInvocationHandler.invoke(ActivityInvocationHandler.java:75)\n     at com.sun.proxy.$Proxy6.composeGreeting(Unknown Source:0)\n     at com.uber.cadence.samples.hello.HelloException$GreetingChildImpl.composeGreeting(HelloException.java:85)\n     ... 5 more\n Caused by: java.io.IOException: Hello World!\n     at com.uber.cadence.samples.hello.HelloException$GreetingActivitiesImpl.composeGreeting(HelloException.java:93)\n     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method:0)\n     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n     at java.lang.reflect.Method.invoke(Method.java:498)\n     at com.uber.cadence.internal.worker.POJOActivityImplementationFactory$POJOActivityImplementation.execute(POJOActivityImplementationFactory.java:162)\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Note that IOException is a checked exception. The standard Java way of adding\nthrows IOException to method signature of activity, child and workflow interfaces is not going to help. It is\nbecause at all levels it is never received directly, but in wrapped form. Propagating it without\nwrapping would not allow adding additional context information like activity, child workflow and\nparent workflow types and IDs. The Cadence library solution is to provide a special wrapper\nmethod ",(0,i.jsx)(n.code,{children:"Workflow.wrap(Exception)"})," which wraps a checked exception in a special runtime\nexception. It is special because the framework strips it when chaining exceptions across logical\nprocess boundaries. In this example IOException is directly attached to ActivityFailureException\nbesides being wrapped when rethrown."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class HelloException {\n\n  static final String TASK_LIST = "HelloException";\n\n  public interface GreetingWorkflow {\n    @WorkflowMethod\n    String getGreeting(String name);\n  }\n\n  public interface GreetingChild {\n    @WorkflowMethod\n    String composeGreeting(String greeting, String name);\n  }\n\n  public interface GreetingActivities {\n    String composeGreeting(String greeting, String name);\n  }\n\n  /** Parent implementation that calls GreetingChild#composeGreeting.**/\n  public static class GreetingWorkflowImpl implements GreetingWorkflow {\n\n    @Override\n    public String getGreeting(String name) {\n      GreetingChild child = Workflow.newChildWorkflowStub(GreetingChild.class);\n      return child.composeGreeting("Hello", name);\n    }\n  }\n\n  /** Child workflow implementation.**/\n  public static class GreetingChildImpl implements GreetingChild {\n    private final GreetingActivities activities =\n        Workflow.newActivityStub(\n            GreetingActivities.class,\n            new ActivityOptions.Builder()\n                .setScheduleToCloseTimeout(Duration.ofSeconds(10))\n                .build());\n\n    @Override\n    public String composeGreeting(String greeting, String name) {\n      return activities.composeGreeting(greeting, name);\n    }\n  }\n\n  static class GreetingActivitiesImpl implements GreetingActivities {\n    @Override\n    public String composeGreeting(String greeting, String name) {\n      try {\n        throw new IOException(greeting + " " + name + "!");\n      } catch (IOException e) {\n        // Wrapping the exception as checked exceptions in activity and workflow interface methods\n        // are prohibited.\n        // It will be unwrapped and attached as a cause to the ActivityFailureException.\n        throw Workflow.wrap(e);\n      }\n    }\n  }\n\n  public static void main(String[] args) {\n     // Get a new client\n     // NOTE: to set a different options, you can do like this:\n     // ClientOptions.newBuilder().setRpcTimeout(5 * 1000).build();\n     WorkflowClient workflowClient =\n         WorkflowClient.newInstance(\n             new WorkflowServiceTChannel(ClientOptions.defaultInstance()),\n             WorkflowClientOptions.newBuilder().setDomain(DOMAIN).build());\n     // Get worker to poll the task list.\n     WorkerFactory factory = WorkerFactory.newInstance(workflowClient);\n     Worker worker = factory.newWorker(TASK_LIST);\n     worker.registerWorkflowImplementationTypes(GreetingWorkflowImpl.class, GreetingChildImpl.class);\n     worker.registerActivitiesImplementations(new GreetingActivitiesImpl());\n     factory.start();\n\n     WorkflowOptions workflowOptions =\n         new WorkflowOptions.Builder()\n             .setTaskList(TASK_LIST)\n             .setExecutionStartToCloseTimeout(Duration.ofSeconds(30))\n             .build();\n     GreetingWorkflow workflow =\n         workflowClient.newWorkflowStub(GreetingWorkflow.class, workflowOptions);\n     try {\n       workflow.getGreeting("World");\n       throw new IllegalStateException("unreachable");\n     } catch (WorkflowException e) {\n       Throwable cause = Throwables.getRootCause(e);\n       // prints "Hello World!"\n       System.out.println(cause.getMessage());\n       System.out.println("\\nStack Trace:\\n" + Throwables.getStackTraceAsString(e));\n     }\n     System.exit(0);\n   }\n\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"The code is slightly different if you are using client version prior to 3.0.0:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public static void main(String[] args) {\n  Worker.Factory factory = new Worker.Factory(DOMAIN);\n  Worker worker = factory.newWorker(TASK_LIST);\n  worker.registerWorkflowImplementationTypes(GreetingWorkflowImpl.class, GreetingChildImpl.class);\n  worker.registerActivitiesImplementations(new GreetingActivitiesImpl());\n  factory.start();\n\n  WorkflowClient workflowClient = WorkflowClient.newInstance(DOMAIN);\n  WorkflowOptions workflowOptions =\n      new WorkflowOptions.Builder()\n          .setTaskList(TASK_LIST)\n          .setExecutionStartToCloseTimeout(Duration.ofSeconds(30))\n          .build();\n  GreetingWorkflow workflow =\n      workflowClient.newWorkflowStub(GreetingWorkflow.class, workflowOptions);\n  try {\n    workflow.getGreeting("World");\n    throw new IllegalStateException("unreachable");\n  } catch (WorkflowException e) {\n    Throwable cause = Throwables.getRootCause(e);\n    // prints "Hello World!"\n    System.out.println(cause.getMessage());\n    System.out.println("\\nStack Trace:\\n" + Throwables.getStackTraceAsString(e));\n  }\n  System.exit(0);\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var o=t(6540);const i={},r=o.createContext(i);function a(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);